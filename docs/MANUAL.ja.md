**MMLxr** \[em-em-elixir\] は [FlMML](http://flmml.codeplex.com/) / 
[ピコカキコ](http://dic.nicovideo.jp/a/%E3%83%94%E3%82%B3%E3%82%AB%E3%82%AD%E3%82%B3)
対応の[MML(Music Macro Language)](https://ja.wikipedia.org/wiki/MML)エディタです。

<div class="markdown-toc"></div>

-----

# 特徴 <a id="features"></a>

ブラウザ（Chrome専用）上のJavaScriptで動作します。
すべてのデータはブラウザ上に保存され、外部サービス連携のためのトークン等以外はサーバに送信されません。

- ブラウザ上のデータベースへのオートセーブ機能 および ファイルシステムへの一括ダウンロード機能
- 詳細エラー表示
- コンパイル結果のピアノロール表示
- ピアノロールからのノートのトレース機能（マクロ呼び出しの追跡）
- シンタックスハイライト（色付け表示）
- トラック単位のミュート・ソロ演奏機能
- 波形データのインポート機能（`.wav`, `.dmc`）
- MMLから生成された音声のエクスポート機能（`.wav`）


# 必要環境 <a id="requirements"></a>

## ブラウザ <a id="requirements-browser"></a>

パフォーマンスの問題上、デスクトップ版 [Google Chrome](https://www.google.co.jp/chrome/browser/desktop/) 専用となります。
他のWebkit・Blink系ブラウザ（Safari, Opera等）でも動作する可能性はありますが、未確認です。


## 推奨マシンスペック <a id="requirements-machine"></a>

トラック数の多いMMLをAtomマシン等で再生すると、音飛びやロケータの位置ずれ等が発生する場合があります。
リソースに余裕のある環境での使用をお奨めします。


# エディタ <a id="editor"></a>

## シンタックスハイライト <a id="editor-highlight"></a>

テキストエディタ上の文字は、コマンドの種類により色分けされます。

|    色    |コマンドの種類          |例                  |@ace-class       |
|:--------:|:-----------------------|:-------------------|:----------------|
|   `白`   |ノート                  |`c`, `d`, `e`, …`g`|entity           |
|   `灰`   |休符                    |`r`                 |entity rest      |
|   `緑`   |時間を扱うコマンド      |`l`, `q` 等         |command time     |
|`すみれ色`|音色・音量を扱うコマンド|`@1`, `v` 等        |command character|
|  `水色`  |音程を扱うコマンド      |`o`, `ns` 等        |command tune     |
|   `赤`   |集合を扱うコマンド      |`/:`…`:/` 等       |punctuation      |
|  `黄色`  |マクロ定義              |                    |definition       |
|   `橙`   |マクロの呼び出し        |                    |variable         |


## スニペット <a id="editor-snippet"></a>

エディタ上で `Ctrl+Space`（Windows）または `Option+Space`（Mac）を押すと、補完ウィンドウが表示されます。
たとえば、ノイズ音色に切り替えるコマンドを入力したいときは `noise` とタイプして補完ウィンドウを開いてみてください。

- 一部のスニペットは `Tab` でパラメータ間を移動しながら値を入力することができます。
- 一部のスニペットは、パラメータが数値として補完されます。通常、補完される値はそのデフォルト値を表しています。


## コンパイルと再生 <a id="editor-transport"></a>

右下のツールバーにあるボタン または 以下の各キー操作で、MMLのコンパイルや再生を行います。

|キー操作（Windows）|キー操作（Mac）      |機能                                                                            |
|:------------------|:--------------------|:-------------------------------------------------------------------------------|
|`Ctrl+Enter`       |`Command+Enter`      |現在のMMLを再生・停止します。                                                   |
|`Ctrl+Shift+Enter` |`Command+Shift+Enter`|再生を一時停止します。この後、再生ボタン または そのキー操作で続きを再生します。|
|`Ctrl+R`           |`Command+R`          |MMLのコンパイルだけを行い、ピアノロールを再描画します。                         |

なお、再生を停止したりMMLを変更した後は、次回再生時にコンパイルが行われます。


## エラー <a id="editor-error"></a>

MMLをコンパイルした際にエラーが見つかると、**Errors** タブにエラー一覧が表示されます。
トレース表示中の行番号をクリックすることで、そのエラーが見つかった箇所にエディタのカーソルが移動します。


## テキストエディタの機能 <a id="editor-ace"></a>

### キーバインド <a id="editor-ace-keybind"></a>

テキストエディタ部には [Ace (Ajax.org Cloud9 Editor)](https://ace.c9.io/) を用いており、キーバインドはそのデフォルト設定に従います（カスタマイズはできません）。
詳しくは [Aceのキーバインド表](https://github.com/ajaxorg/ace/wiki/Default-Keyboard-Shortcuts) をご覧ください。

- エディタにフォーカスがあるときに `Ctrl+Alt+H`（Windows）または `Command+Option+H`（Mac）を押すと、キーバインド一覧のヘルプが表示されます。
- エディタ外にフォーカスがあるとき（カーソルがグレー表示になっているとき）に `Tab` キーを押すと、エディタにフォーカスを戻すことができます（この操作は本アプリケーション特有のものです）。

### マルチカーソル <a id="editor-ace-multicursor"></a>

文字列を選択状態にしてから `Ctrl+Alt+→`（Windows）または `Command+Option+→`（Mac）を押すと、その文字列が他に現れる箇所を連続して同時に選択できます。
この状態で文字列を入力すると、選択されたすべての箇所に同時に入力されます。

### 検索・置換 <a id="editor-ace-search"></a>

エディタにフォーカスがあるときに `Ctrl+F`（Windows）または `Command+F`（Mac）を押すと、検索ウィンドウを表示します。
Allボタンを押すことでマッチしたすべての箇所が同時に選択され、マルチカーソルと同様の操作を行えます。



# ピアノロール <a id="pianoroll"></a>

## ノート情報とトレース <a id="pianoroll-notes"></a>

ノートをクリック または `Shift` を押しながらマウスオーバーすることで、**Notes** タブに **Note**（音程）・**Duration**（音長）等のノート情報が表示されます。
併せて表示される **Volume**, **Waveform** 等のパラメータは、そのノートが発音される時に適用されている値を表しています。

**Trace** テーブルは、そのノートがMML中のどの箇所から生成されたのかを表しており、マクロ呼び出しの経路をたどることができます。
トレース中の行番号をクリックすることで、その箇所にエディタのカーソルが移動します。


## ソロ・ミュート <a id="pianoroll-tracks"></a>

**Tracks** タブには各トラック用の **Solo**, **Mute** ボタンが配置されています。
これらを押すことで、特定の1トラックのみを発音させたり、任意のトラックを消音することができます。

なお、バッファリングの都合上、各ボタンを押してから音声として反映されるまでにややディレイがあります。ご注意ください。



# ファイル管理 <a id="file"></a>

ファイルには **スロットID** が割り当てられ、対応する保存領域にオートセーブされます。
保存操作をしなくても、編集中の最新のMMLが常に上書き保存されるため、
**大事なファイルを開いた状態のまま、編集内容を破棄する前提での編集を行わないようご注意ください** 。

オートセーブを保存しておく際は **プロテクト** 操作が必要です。
プロテクトされていないスロットのMMLは、**最大 5 件** まで保存され、
それを超えると **古いものから削除されます** のでご注意ください。

以下は、メニュー項目についての説明です。

## 新規ファイル <a id="file-new"></a>

エディタの内容を空白状態にし、新しいスロットIDを割り当てます。
既存ファイルを編集した後に新しいMMLを書き始める際は、必ずこの操作を行ってください。
また、アプリケーション起動直後にオートセーブの読み込みを行わなかった場合は、新規ファイルと同じ状態になります。


## オートセーブを開く <a id="file-open"></a>

ブラウザ上に保存されているオートセーブを開き、編集を続けます。
ロードしたファイルのスロットIDが引き継がれるため、この後に編集した内容は元のファイルに上書き保存されます。


## オートセーブ時にプロテクト <a id="file-protect"></a>

編集中のMMLをオートセーブする際にプロテクトします。
プロテクト中は、メニュー項目の右にチェックマークが表示されます。


## オートセーブをバックアップ <a id="file-backup"></a>

オートセーブのうち、プロテクトされているすべてのスロットをZIPファイル（`.zip`）に圧縮してダウンロードします。
定期的にこの操作を行い、大事なMMLをファイルシステム上にバックアップするようお願いします。


## ローカルファイルをインポート <a id="file-import_local"></a>

お使いのマシンのローカルファイルシステム上にあるファイルをエディタに読み込み、新しいスロットIDを割り当てます。
拡張子は `.txt`, `.mml`, `.flmml` のいずれかである必要があります。


## ピコカキコからインポート <a id="file-import_pikokakiko"></a>

[ピコカキコ](http://dic.nicovideo.jp/a/%E3%83%94%E3%82%B3%E3%82%AB%E3%82%AD%E3%82%B3)
からMMLを読み込み、新しいスロットIDを割り当てます。

ソースとなるピコカキコを、以下のいずれかのフォーマットで指定してください。

- `123456` (整数) :
  まとめ表などに整数の番号が記載されている場合、それを入力します。
- `http://dic.nicovideo.jp/mml/123456`, `http://dic.nicovideo.jp/mml_id/123456` :
  記事中にMMLへのリンクが張られている場合、そのURLをコピー＆ペーストします。
- `<img src="/img/pikoplayer.png" alt="123456">`
  ピコカキコのプレイヤーの近くに **記事内再生用タグ** が表示されている場合、そのタグをコピー＆ペーストします。

なお、本アプリケーションは [ニコニコ大百科](http://dic.nicovideo.jp/) の運営者とは無関係です。
本アプリケーションについてニコニコ大百科の運営者にお問い合わせしないようお願いします。


## .wav/.dmcから\#WAV9を挿入 <a id="file-import_wav9"></a>

お使いのマシンのローカルファイルシステム上にあるWAVファイル（`.wav`）または DMCファイル（`.dmc`）を、
`#WAV9`（FC DPCM音源）で使用可能な波形データに変換してエディタに読み込みます。

WAVファイルからの変換時には、以下のパラメータの指定が求められます。

- **Start Position**, **End Position** : 波形を切り取る範囲を指定します。
  数値を入力するほか、表示されている波形上でドラッグすることでも範囲を決めることができます。
- **Stereo Source Processing** : ステレオ音源の場合、左右どちらのチャンネルを使用するかを指定します。
- **DPCM Sampling Rate** : 変換後の波形のサンプリングレートを指定します。
  通常は、ソース音源のサンプリングレートに合わせて最適な値が自動選択されます。
- **Loop** : ループ音源として使用する場合はONにします。

読み込み後、割り当てられた音色IDを通知するメッセージが画面左上に表示されます。


## 音声ファイルを生成 <a id="file-generate"></a>

編集中のMMLから音声ファイルを生成し、WAVファイル（`.wav`）または MP3ファイル（`.mp3`）として保存します。
出力されるファイルは、現バージョンでは以下の品質に固定されています。

- サンプリングレート : 44100
- MP3ビットレート : 224kbps



# Copyright

**MMLxr** &nbsp; Copyright © 2016 Mersenne Sister

